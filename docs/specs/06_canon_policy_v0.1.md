# Canon Policy v0.1

## 1) Front Matter

* **Title:** Canon Policy v0.1
* **Version:** v0.1
* **Date:** 2025-12-16
* **Status:** Draft
* **Suggested repo path:** `/docs/specs/06_canon_policy_v0.1.md`

## 2) Purpose

In Field-Kit v0.1 (private/local), “canon” exists to support **curation + trust + replay + editing workflow** inside a workshop Episode. Canon is not about public truth or global authority; it is about defining which persisted objects are treated as **committed vs provisional**, what is **authoritative for audit**, and how an Episode can be projected into a **presentable bundle** without introducing sharing/publishing complexity.

### Terms (v0.1)

* **Episode:** A local, user-owned container for one working session. Every persisted object and every QDPIEvent belongs to exactly one Episode via `episode_id`.
* **Item:** A persistent node of content in the Field, created by a user or generated by an operator. Items are addressable by ID and include a `type` (e.g., `Q`, `M`, `D`, `H`) plus content and minimal metadata.
* **Bond:** A persistent instruction that connects one or more input Items to an operator run. `prompt_text` is the primary instruction. Bonds are created as `status:"draft"` and may be executed; execution generates exactly one output Item and MUST set `status:"executed"` and `output_item_id`.
* **QDPIEvent:** An append-only event record that logs meaningful actions and results. Each event includes `qdpi` (Queue/Monologue/Dialogue/Holologue), `direction` (user→field or system→field), a `name`, a timestamp, and refs to related object IDs.
* **Proposal:** A system suggestion (e.g., suggested Bond prompts) that is logged as events only until the user explicitly confirms creation.
* **Canon:** A user-curated projection over Items/Bonds within an Episode used for presentation or replay. Canon never overrides the append-only event log.
* **Bundle:** A structured artifact output of a Holologue run (many→one) capturing what was selected, what was generated, and any optional proposals. A Bundle may be represented as a single output Item plus an exportable JSON payload.

## 3) Scope and Non-goals (v0.1)

* v0.1 is **Private • Local**: no accounts, no cloud sync, no collaboration, no publishing.
* Canon in v0.1 is a **local curation mechanic** for an Episode’s workshop workflow; it is **not public truth** and does not claim global authority.
* This document does **not** introduce payments, crypto, or any real-money mechanism.

## 4) Terms (definitions)

* **Canon (v0.1 meaning)**
  A *curated projection* over persisted workshop objects (Items/Bonds) and their lineage, suitable for presentation/replay. Canon is a **selection** of committed structure; it is not “truth.”

* **Canonical (v0.1 meaning)**
  An Item or Bond is **canonical** if it is included in the Episode’s **curated view (canon projection)** (i.e., listed in curated IDs) and is **not archived**.

* **Draft (Item/Bond draft)**
  A persisted object that is still in-progress. In v0.1, this primarily applies to **Bond.status="draft"** with `output_item_id:null`. Items don’t have a draft flag; they are workshop objects that may be curated (canonical) or not.

* **Proposal (event-only prompt suggestion)**
  A suggested Bond prompt emitted as a **QDPIEvent** (e.g., `bond.suggestions.presented`, `bond.proposals.presented`). Proposals are **not persisted Bonds** until the user confirms.

* **Committed (persisted object vs suggestion)**
  **Committed** means a durable object exists in local storage (Item/Bond/Episode/Network) and is auditable via the Ledger. `store.commit` events **SHOULD** exist as a durability/audit signal, but persistence is determined by **object existence in the store**, not by the presence/absence of a specific commit event.
  **Committed is not the same as canonical**: many committed objects are not included in the curated view.

* **Executed**

  * **Executed Bond:** `Bond.status:"executed"` with non-null `output_item_id`.
  * **Completed Holologue:** `holologue.completed` exists and its output Item `type:"H"` is persisted with provenance `created_by:"holologue"`.

* **Artifact (Holologue output Item)**
  The single output Item from a Holologue run (`type:"H"`), with provenance `created_by:"holologue"`, `holologue_event_id`, `selected_item_ids`, `artifact_kind`.

* **Episode as workshop**
  A mutable container for work in progress. Objects in an Episode can be created, edited, executed, archived, and curated.

* **Snapshot (optional in v0.1)**
  A stable “presentable view” of an Episode at a point in time. v0.1 may implement a minimal snapshot as a curated list stored in Episode metadata; it is local-only and does not imply publishing.

## 5) Canon Levels / States (v0.1)

### Chosen approach: **Option A — Canon is derived (no new canon field in v0.1)**

Canon is inferred from existing object existence + provenance + lifecycle status + archived state + Episode curation metadata.

**Explicit distinction (normative):**

* **Committed** = object exists in storage (auditable in Ledger).
* **Canonical** = object is included in the Episode’s curated projection (curated lists) and non-archived.
  Do not treat “committed” as “canonical.”

#### Derived canon rules (enforceable)

* **Proposals (events only): never canonical**

  * `bond.suggestions.presented` / `bond.proposals.presented` are not canonical; they are suggestions recorded for audit and UX traceability.
* **Draft Bonds: provisional**

  * `Bond.status:"draft"` (with `output_item_id:null`) is working/provisional. It is **not canonical by default** and is discouraged in curated views.
* **Executed Bonds + their output Items: committed (eligible for canon)**

  * Executed Bonds (`status:"executed"`) and their output Items (`Item.provenance.created_by:"bond"`) are committed workshop objects and are eligible to become canonical if curated.
* **Holologue outputs: committed artifacts (eligible for canon)**

  * Holologue output Items (`type:"H"`, `created_by:"holologue"`) are committed workshop artifacts and are eligible to become canonical if curated.
  * They are still editable as workshop Items; “committed” does not imply “frozen.”
* **Archived objects: not canonical**

  * Any Item/Bond marked archived is excluded from canon projections.

#### Practical v0.1 canon definition

> In v0.1, **canon = the set of non-archived persisted objects that are selected by the Episode’s curated projection** (Section 8), plus their lineage badges. Events remain the authoritative audit trail.

## 6) What is authoritative (v0.1)

**Hierarchy (normative):**

1. **QDPIEvents are authoritative for audit/replay**

   * QDPIEvents are append-only and immutable. They are the record of what happened and in what order.
2. **Objects are mutable workshop snapshots**

   * Items and Bonds represent the current workshop state and are editable within constraints.
3. **Canon view is a curated projection**

   * Canon is a selection over objects, informed by provenance and events.
   * Canon is not truth; canon is “selected structure for presentation/replay.”

**Developer enforcement rule:**

* Never infer “canon” from a single object alone; always compute it from object state **plus** curation projection rules.

## 7) Editing & Immutability rules

### Items (v0.1)

* **Editable fields:** `title`, `body`, `position` (and other presentational fields), `updated_at`.
* **Immutable fields:** `id`, `network_id`, `episode_id`, `type`, and **provenance** block.

  * You may add new optional fields in later versions, but provenance must remain immutable once set.
* **Archiving vs deletion:**

  * v0.1 **recommends archive, not delete**. Deleting breaks audit expectations.
  * Archiving removes from curated views but preserves history.

### Bonds (v0.1)

* **While draft (`status:"draft"`):**

  * Required invariant: `output_item_id:null`.
  * Editable: `prompt_text`, `input_item_ids` (subject to validation), optional `intent_type`, `updated_at`.
* **After execution (`status:"executed"`):**

  * Required invariant: `output_item_id` is set (non-null).
  * **Immutable:** `prompt_text`, `input_item_ids` (these define lineage).
  * Mutable: execution metadata (e.g., `executed_at`, `execution_count`, `last_error` cleared), and `output_item_id` **only via re-execution** (see below).
* **Failures:**

  * A failed run leaves the Bond as `status:"draft"` with `last_error` set; there is no “failed” status in v0.1.

### Re-execution behavior (allowed; history preserved)

* Re-executing a Bond is allowed. If re-execution produces a new output:

  * `Bond.output_item_id` is updated to the newest output Item ID.
  * **Prior output Items remain in the store** with their provenance intact (history is not deleted).
  * Event trail must show multiple `bond.run_requested` / `bond.executed` occurrences (ordered by seq).

### Deletion policy (v0.1)

* **Do not hard-delete** Items/Bonds once referenced by:

  * a QDPIEvent `refs`, or
  * a Bond `input_item_ids` / `output_item_id`, or
  * an Item provenance link.
    Use archive instead.

## 8) Episode curation rules (v0.1)

### Chosen mechanic: **Curated list stored in Episode metadata (implementable now)**

**Justification:**
A curated list is explicit, testable, and does not require a complex view language. It enables a “presentable bundle” without introducing publishing.

#### Curation model (v0.1)

* Episode includes a curated set of object IDs:

  * `episode.curated_item_ids: string[]`
  * `episode.curated_bond_ids: string[]`
* Default state on new Episode: empty curated lists.

#### Curated list validity rules (v0.1; enforceable)

When writing or loading curated lists:

* **Uniqueness:** IDs must be unique within each list (no duplicates).
* **Referential validity:** each ID must resolve to an existing object in storage.
* **Scope validity:** each resolved object must match the Episode’s `network_id` and `episode_id`.
* **Archived handling (chosen v0.1 behavior):** archived objects are **ignored (filtered out)** during projection and SHOULD be surfaced as a non-blocking warning; curated lists are not automatically mutated in v0.1.
* **Missing IDs:** if an ID cannot be resolved, ignore it and surface a non-blocking warning (“curation references missing object …”).

#### Ordering rule (v0.1; deterministic)

Curated lists are **ordered arrays**; order is preserved and is the **presentation order** in the curated view.

#### Inclusion rules

* **Only persisted, non-archived objects can be canonical** (i.e., appear in the curated projection).
* **Proposals (events) cannot be canonical** (no IDs to curate).
* Recommended default curation behavior for Guided Tutorial:

  * Suggest curation actions after successful proofs (e.g., after an executed Bond or Holologue), but do not auto-curate without user action in v0.1.

#### Draft Bonds in curated views (chosen rule)

* Draft Bonds are **discouraged** but **allowed only if explicitly listed** in `episode.curated_bond_ids`. (They are never included implicitly.)

#### Projection algorithm (v0.1)

Given an Episode with `curated_item_ids` and `curated_bond_ids`, compute the curated view (canon projection) as:

1. **Curated Items**

   * Start with `episode.curated_item_ids` (in order).
   * Filter to IDs that resolve to existing Items where:

     * `item.network_id == episode.network_id`
     * `item.episode_id == episode.id`
     * `item.archived_at` is null/absent
   * Ignore missing or archived IDs (warn).

2. **Curated Bonds**

   * Start with `episode.curated_bond_ids` (in order).
   * Filter to IDs that resolve to existing Bonds where:

     * `bond.network_id == episode.network_id`
     * `bond.episode_id == episode.id`
     * `bond.archived_at` is null/absent
   * Draft Bonds appear only if explicitly listed (warn if draft).
   * Ignore missing or archived IDs (warn).

3. **Explicit exclusions**

   * Never include proposals (`bond.suggestions.presented`, `bond.proposals.presented`), since they are events only.

4. **Lineage display**

   * For every curated Item, display minimal lineage badges based on provenance:

     * `created_by:"bond"` → “Derived from Bond bd_… (from N inputs)”
     * `created_by:"holologue"` → “Holologue artifact (from N items) · kind=…”
   * Ancestors are not auto-included (Section 10).

#### Recommended event names for curation actions (optional in v0.1)

Curation changes MAY be logged as QDPIEvents for replay/audit (recommended but optional in v0.1).

**Recommended conventions (v0.1):**

* Curation decisions are user-authored decisions → `qdpi:"D"`, `direction:"user→field"`.
* The system may then persist Episode metadata and append `store.commit` (Queue) as a durability/audit signal.

Suggested event names:

* `episode.curated_item_added` (**D**, `direction:"user→field"`)
* `episode.curated_item_removed` (**D**, `direction:"user→field"`)
* `episode.curated_bond_added` (**D**, `direction:"user→field"`)
* `episode.curated_bond_removed` (**D**, `direction:"user→field"`)

## 9) Credits and canon (v0.1 simulation)

Credits are optional in v0.1 and exist only to support “gamey” local feedback for workshop actions (including curation), without implying real money.

* Credits are **local-only** and **purely simulated** in v0.1.
* Credits are **not transferable**, **not redeemable**, and have **no USD exchange rate** in v0.1.
* Credits are represented as append-only QDPIEvents named `credits.delta`; balance is a derived view.

### Credits event (standard pattern)

* **Event name:** `credits.delta`
* **qdpi:** `"Q"`
* **direction:** `system→field`
* `refs` MUST include:

  * `delta` (integer; can be positive, negative, or 0)
  * `balance_after` (integer)
  * `reason` (string)
  * optional related IDs (e.g., `related_item_id`, `related_bond_id`, `related_event_id`)

### Optional credit policy for curation actions (defaults; tunable)

These defaults are intentionally small and non-economic; they are safe to omit entirely.

* When user adds an Item to curated list:

  * Append `episode.curated_item_added` (**D**, `direction:"user→field"`)
  * Then append `credits.delta` with `delta:+1`, `reason:"curation_add_item"` and `related_item_id`
* When user adds an **executed Bond** to curated list:

  * Append `episode.curated_bond_added` (**D**, `direction:"user→field"`)
  * Then append `credits.delta` with `delta:+1`, `reason:"curation_add_bond"` and `related_bond_id`
* When user removes from curated list:

  * Append `episode.curated_*_removed` (**D**, `direction:"user→field"`)
  * Then append `credits.delta` with `delta:0`, `reason:"curation_remove_no_penalty"`
    **Justification (v0.1):** no penalty encourages iterative curation and avoids “loss aversion” dynamics in a workshop tool.

### Minimal JSON example (curate item + credits)

```json
[
  {
    "schema_version": 1,
    "id": "ev_01JFCANON0000000000000001",
    "network_id": "nw_01JFCANON0000000000000001",
    "episode_id": "ep_01JFCANON0000000000000001",
    "ts": "2025-12-16T00:20:00.000Z",
    "seq": 41,
    "qdpi": "D",
    "direction": "user→field",
    "actor": { "kind": "user", "id": "local-user", "display": "You" },
    "name": "episode.curated_item_added",
    "refs": {
      "item_id": "it_01JFCANON0000000000000001"
    }
  },
  {
    "schema_version": 1,
    "id": "ev_01JFCANON0000000000000002",
    "network_id": "nw_01JFCANON0000000000000001",
    "episode_id": "ep_01JFCANON0000000000000001",
    "ts": "2025-12-16T00:20:00.010Z",
    "seq": 42,
    "qdpi": "Q",
    "direction": "system→field",
    "actor": { "kind": "system", "id": "system", "display": "Field-Kit" },
    "name": "credits.delta",
    "refs": {
      "delta": 1,
      "balance_after": 23,
      "reason": "curation_add_item",
      "related_item_id": "it_01JFCANON0000000000000001",
      "related_event_id": "ev_01JFCANON0000000000000001"
    }
  }
]
```

## 10) Provenance and Canon interaction

### Canon does not automatically include ancestors (chosen rule)

* **Rule:** Curating an Item does **not** automatically curate its ancestors (inputs) or generating Bonds.
* **Reason:** Allows “presentable bundle” to be concise and avoids unintended inclusion of rough notes.

### Minimal lineage display in curated view

Even if ancestors are not curated, the curated view must display minimal lineage cues:

* For Items created by Bond: show badge **“Derived from Bond bd_…”** and optionally **“from N inputs”**.
* For Holologue outputs: show badge **“Holologue artifact (from N items)”** and expose `artifact_kind`.

### Avoiding canon drift when objects are edited

* Objects are mutable workshop snapshots, so curated items may evolve.
* The authoritative audit trail remains QDPIEvents; the curated view is a selection over the **latest** object snapshots.
* If the user needs a “frozen” version, that is handled by **Snapshot** (future or optional in v0.1), not by changing object immutability.

## 11) Failure / edge cases

1. **Executed bond output Item archived later**

   * Outcome: Bond remains executed; its `output_item_id` points to an archived Item.
   * Canon rule: archived output is excluded from curated projections; show a warning in curated view: “Output archived.”
   * Developer rule: do not auto-unarchive; require explicit user action.

2. **Bond re-executed producing a new output**

   * Outcome: `output_item_id` updates to newest output; old output Items remain.
   * Canon rule: if the Bond or newest output Item is curated, curated view should reflect the **current** `output_item_id`. Old outputs are not deleted and may be curated separately if desired.

3. **Holologue run produces artifact, then user edits it heavily**

   * Outcome: still a Holologue artifact by provenance; content changes are allowed.
   * Canon rule: if curated, curated view shows latest edited state. Provenance remains immutable.

4. **Proposals presented but never accepted**

   * Outcome: events exist; no Bonds created.
   * Canon rule: proposals never appear in curated view; they remain inspectable in Ledger events only.

5. **User wants to “reset episode”**

   * **Recommended reset behavior (v0.1):**

     1. Clear `episode.curated_item_ids` and `episode.curated_bond_ids`.
     2. Optionally bulk-archive selected or all Items/Bonds in the Episode (preserving history).
     3. Create a new Episode and set it as active.
     4. **Do not delete events**; history remains auditable in Ledger.
   * If implemented, optionally append `episode.reset_requested` with **qdpi:"Q"** and `direction:"user→field"` because it is a user **request** to reinitialize workshop state (not authored content).

## 12) Minimal UI implications (brief)

### What the user sees (v0.1)

* **Working (default):** normal canvas with all non-archived Items; draft Bonds may be visible.
* **Curated view (canon projection):** shows only curated Items/Bonds (non-archived), with lineage badges.
* **Archived:** archived objects are hidden from both working and curated views by default (may be accessible via a filter).

### How to curate/uncurate (simple and enforceable)

* On Item detail: **“Add to Curated”** / **“Remove from Curated”**
* On Bond detail: **“Add to Curated”** / **“Remove from Curated”**
* On Episode view: **“Curated”** tab that renders curated lists (in preserved order).

### How Ledger helps explain canon

* Ledger shows:

  * immutable event trail (QDPIEvents)
  * object snapshots (Items/Bonds)
  * provenance for lineage (why an Item exists)
* Canon/curation can be explained as: “Curated view is a filter over objects; Ledger is the full history.”

## 13) Definition of Done (checklist)

* [ ] Canon model is implemented as **derived** (Option A): no new `canon_status` field is required in v0.1.
* [ ] “Committed” vs “canonical” is enforced:

  * [ ] Committed = object exists in storage
  * [ ] Canonical = included in curated projection (curated lists) and non-archived
* [ ] Proposals are **events only** and are never treated as canonical or shown in curated views.
* [ ] Bonds enforce lifecycle rules:

  * [ ] `status:"draft"` bonds have `output_item_id:null` and are editable
  * [ ] `status:"executed"` bonds have non-null `output_item_id`
  * [ ] executed bonds’ `prompt_text` and `input_item_ids` are immutable
* [ ] Items enforce editing rules:

  * [ ] `title/body/position` editable
  * [ ] provenance immutable once set
* [ ] Re-execution preserves history:

  * [ ] prior output Items are not deleted when `output_item_id` changes
  * [ ] event trail shows each run in order
* [ ] Archive (not delete) is available for Items and Bonds and is honored by curated projection.
* [ ] Episode curation is implementable now:

  * [ ] Episode stores curated lists of IDs (`curated_item_ids`, `curated_bond_ids`)
  * [ ] curated projection filters to existing + same network/episode + non-archived
  * [ ] curated lists enforce uniqueness (no duplicates)
  * [ ] missing/invalid IDs are ignored with warning
  * [ ] archived IDs are ignored (filtered out) with warning (no auto-mutation in v0.1)
  * [ ] list order is preserved and defines presentation order
  * [ ] proposals are never included
  * [ ] lineage badges render from provenance even if ancestors are not curated
* [ ] (Optional) Curation actions can be audited:

  * [ ] `episode.curated_*` events use `qdpi:"D"` and `direction:"user→field"`
* [ ] (Optional) Credits simulation (local-only) can be audited:

  * [ ] `credits.delta` uses `qdpi:"Q"`, `direction:"system→field"`, and `refs.delta/balance_after/reason`
* [ ] No public sharing/publishing scopes are introduced; v0.1 remains private/local.

## 14) Open Questions (5–10)

1. Should curation events (`episode.curated_*`) be considered required (not optional) for replay-grade auditing in v0.2, or remain optional long-term?
2. Should the UI support drag-and-drop reordering of curated lists in v0.1, and if so should reorder actions be logged as events (e.g., `episode.curated_order_changed`)?
3. Should draft Bonds ever be allowed into curated view (for “unfinished but presentable” work), or should the UI eventually forbid it entirely?
4. Do we need a lightweight Snapshot object in v0.1 to freeze curated content at a moment in time, or can this wait for v0.2?
5. When a curated Item’s generating Bond is not curated, should the curated view still show the Bond ID in the lineage badge or only “derived from inputs”?
6. Should Holologue artifacts have a recommended default curation action (prompt user to curate after creation), or remain purely manual?
7. How should “reset episode” be represented in the UI without implying deletion of history, and should it always create a new Episode (vs reusing the same one)?
8. If Credits simulation is enabled, should credits changes be emitted for reorder actions (likely no), or only for add/remove?
9. Should the curated view support an optional “include lineage ancestors” toggle for presentation, without mutating curated lists?